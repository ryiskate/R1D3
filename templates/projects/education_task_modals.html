<!-- Filter Modal -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterModalLabel">Filter Education Tasks</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="filterForm" method="get">
                    <div class="mb-3">
                        <label for="statusFilter" class="form-label">Status</label>
                        <select class="form-select" id="statusFilter" name="status">
                            <option value="">All Statuses</option>
                            <option value="backlog" {% if request.GET.status == 'backlog' %}selected{% endif %}>Backlog</option>
                            <option value="to_do" {% if request.GET.status == 'to_do' %}selected{% endif %}>To Do</option>
                            <option value="in_progress" {% if request.GET.status == 'in_progress' %}selected{% endif %}>In Progress</option>
                            <option value="in_review" {% if request.GET.status == 'in_review' %}selected{% endif %}>In Review</option>
                            <option value="done" {% if request.GET.status == 'done' %}selected{% endif %}>Done</option>
                            <option value="blocked" {% if request.GET.status == 'blocked' %}selected{% endif %}>Blocked</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="priorityFilter" class="form-label">Priority</label>
                        <select class="form-select" id="priorityFilter" name="priority">
                            <option value="">All Priorities</option>
                            <option value="low" {% if request.GET.priority == 'low' %}selected{% endif %}>Low</option>
                            <option value="medium" {% if request.GET.priority == 'medium' %}selected{% endif %}>Medium</option>
                            <option value="high" {% if request.GET.priority == 'high' %}selected{% endif %}>High</option>
                            <option value="critical" {% if request.GET.priority == 'critical' %}selected{% endif %}>Critical</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="courseFilter" class="form-label">Course</label>
                        <select class="form-select" id="courseFilter" name="course_id">
                            <option value="">All Courses</option>
                            {% for course in courses %}
                            <option value="{{ course.id }}" {% if request.GET.course_id == course.id %}selected{% endif %}>{{ course.title }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="audienceFilter" class="form-label">Target Audience</label>
                        <select class="form-select" id="audienceFilter" name="target_audience">
                            <option value="">All Audiences</option>
                            <option value="beginners" {% if request.GET.target_audience == 'beginners' %}selected{% endif %}>Beginners</option>
                            <option value="intermediate" {% if request.GET.target_audience == 'intermediate' %}selected{% endif %}>Intermediate</option>
                            <option value="advanced" {% if request.GET.target_audience == 'advanced' %}selected{% endif %}>Advanced</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="assignedToFilter" class="form-label">Assigned To</label>
                        <select class="form-select" id="assignedToFilter" name="assigned_to">
                            <option value="">All Users</option>
                            <option value="unassigned" {% if request.GET.assigned_to == 'unassigned' %}selected{% endif %}>Unassigned</option>
                            {% for user in users %}
                            <option value="{{ user.id }}" {% if request.GET.assigned_to == user.id|stringformat:'i' %}selected{% endif %}>{{ user.get_full_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="dueDateFilter" class="form-label">Due Date</label>
                        <select class="form-select" id="dueDateFilter" name="due_date_range">
                            <option value="">All Due Dates</option>
                            <option value="overdue" {% if request.GET.due_date_range == 'overdue' %}selected{% endif %}>Overdue</option>
                            <option value="today" {% if request.GET.due_date_range == 'today' %}selected{% endif %}>Due Today</option>
                            <option value="this_week" {% if request.GET.due_date_range == 'this_week' %}selected{% endif %}>Due This Week</option>
                            <option value="next_week" {% if request.GET.due_date_range == 'next_week' %}selected{% endif %}>Due Next Week</option>
                            <option value="this_month" {% if request.GET.due_date_range == 'this_month' %}selected{% endif %}>Due This Month</option>
                            <option value="no_date" {% if request.GET.due_date_range == 'no_date' %}selected{% endif %}>No Due Date</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="applyFiltersBtn">Apply Filters</button>
            </div>
        </div>
    </div>
</div>

<!-- Batch Update Modal -->
<div class="modal fade" id="batchUpdateModal" tabindex="-1" aria-labelledby="batchUpdateModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="batchUpdateModalLabel">Batch Update Tasks</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="batchUpdateForm">
                    <div class="mb-3">
                        <label for="batchStatus" class="form-label">Status</label>
                        <select class="form-select" id="batchStatus" name="status">
                            <option value="">No Change</option>
                            <option value="backlog">Backlog</option>
                            <option value="to_do">To Do</option>
                            <option value="in_progress">In Progress</option>
                            <option value="in_review">In Review</option>
                            <option value="done">Done</option>
                            <option value="blocked">Blocked</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="batchPriority" class="form-label">Priority</label>
                        <select class="form-select" id="batchPriority" name="priority">
                            <option value="">No Change</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="batchAssignedTo" class="form-label">Assigned To</label>
                        <select class="form-select" id="batchAssignedTo" name="assigned_to">
                            <option value="">No Change</option>
                            <option value="unassigned">Unassigned</option>
                            {% for user in users %}
                            <option value="{{ user.id }}">{{ user.get_full_name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="batchDueDate" class="form-label">Due Date</label>
                        <input type="date" class="form-control" id="batchDueDate" name="due_date">
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="clearDueDate" name="clear_due_date">
                            <label class="form-check-label" for="clearDueDate">Clear Due Date</label>
                        </div>
                    </div>
                    <input type="hidden" id="batchTaskIds" name="task_ids">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="applyBatchUpdateBtn">Update Tasks</button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container for Notifications -->
<div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

<script>
    // Set the batch update URL for the JavaScript file
    const batchUpdateUrl = "{% url 'education:batch_task_update' %}";
</script>
